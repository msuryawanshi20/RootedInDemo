<apex:page id="pg" standardController="rstk__soship__c" extensions="rstk.ControllerExtnSOShip,rstk.ControllerJobStatus,rstk.RemoteQueryController" sideBar="false" action="{!doBeforePageLoad}">
    <apex:variable var="c" value="{!rstk__soship__c}" />
    <apex:variable var="f" value="{!$ObjectType.rstk__soship__c.fields}" />
    <apex:variable var="f_el" value="{!$ObjectType.rstk__soshipline__c.fields}" />
    <apex:variable var="f_cel" value="{!$ObjectType.rstk__socontainel__c.fields}" />
    <apex:variable var="f_c" value="{!$ObjectType.rstk__socontainer__c.fields}" />
    <apex:variable var="f_cu" value="{!$ObjectType.rstk__socust__c.fields}" />
    <apex:variable var="f_so" value="{!$ObjectType.rstk__sohdr__c.fields}" />
    <apex:variable var="f_rma" value="{!$ObjectType.rstk__sorma__c.fields}" />
    <c:standardHeader cntr="{!controller}" title="{!$Label.rstk__pagetitle_soship}"/>
    
    <apex:stylesheet value="{!$Resource.rstk__ModalPopup_css}"/>
    <apex:includeScript value="{!$Resource.rstk__RowHandler_js}"/>

    <style>
        .hidden{visibility:hidden;}
        .rcptinput{
            width:60px;
            text-align:right; 
        }
        .sort {display:inline}
        .numSort {display:inline}

            .modal {
                background-color:#fff;
                display:none;
                padding:15px;
                text-align:left;
                font-size:1em;
                border:2px solid #333;
            
                opacity:1.0;
                -moz-border-radius:6px;
                -webkit-border-radius:6px;
                -moz-box-shadow: 0 0 50px #ccc;
                -webkit-box-shadow: 0 0 50x #ccc;
            }
            
            .modal h2 {
                margin:0px;
                padding:10px 0 10px 45px;
                font-size:16px;
            }
            
            .modalComponents {
                color:#efefef;
                height:450px;
                z-index:100;
            }

        .modalPopup{
             background-color: white;
             border-style: solid;
             border-width: 3px;
             padding:1px;
             position: absolute;
             z-index: 10011;
             width: 650px;
             top:100px;
             overflow:auto;
         }
        .topPopup{
             background-color: transparent;
             border-style: none;
             position: absolute;
             z-index: 20001;
             width: 50px;
             top:100px;
         }
        .popupBackground{
             background-color:black;
             opacity: 0.20;
             position:absolute;
             width: 100%;
             height: 100%;
             top: 0;
             left: 0;
             z-index: 10010;
         }
        .topPopupBackground{
             background-color:green;
             opacity: 0.10;
             position:absolute;
             width: 100%;
             height: 100%;
             top: 0;
             left: 0;
             z-index: 20000;
         }
            
    </style>
    
    <script>
        var soshiplineid = null;
        // RSTK-1274
        var isRootDox = {!isRootDox};
        var defaultTemplateForDox = '{!defaultTemplateForDox}';
        //
        function jqueryOnReady() {
            jQuery("input").keypress(function(e) { if (e.which == 13) { e.preventDefault(); }});
            initHoverPopups(jQuery("#bodyTable"), {manualClose:false, displayUp:true, onClose:{}});
            
            jQuery("button[rel*=popup]").overlay({
            
                top: "10%",
            
                // some mask tweaks suitable for modal dialogs
                mask: {
                    color: '#ebecff',
                    loadSpeed: 200,
                    opacity: 0.8
                },
            
                closeOnClick: false
            }); 

            jQuery("button[rel*=win]").overlay({
                mask: {
                    color: '#ebecff',
                    loadSpeed: 200,
                    opacity: 0.8
                },
                
                closeOnClick: false,
                
                onBeforeLoad: function(e) {
                    jQuery('#winVFPage').block({
                        message: '',
                        centerX: true, 
                        centerY: true,
                        css: { 
                            border: 'none', 
                            padding: '15px', 
                            cursor: 'wait',
                            opacity: .5, 
                            textAlign: 'center'
                        }
                    });
                    
                    var winId = e.target.getTrigger().attr('class').substring(3);
                    
                    var content = jQuery("#"+winId+"Frame");
                    if (content.length > 0) {
                        if (winId == 'SerialDetails') {
                            content[0].src = "/apex/ShipperLineSerials?soshiplineid="+soshiplineid; 
                        } 
                    
                        content.load(function() {
                            jQuery('#winVFPage').unblock();
                        });
                    }
                },
                onClose: function(e){
                    var winId = e.target.getTrigger().attr('class').substring(3);
                    var content = jQuery("#"+winId+"Frame");
                    if (content.length > 0) { 
                        content[0].src = 'about:blank';
                    }
                }
            });  
            
            jQuery('.chkb').bind('click', function(){
                var ischecked = jQuery(this).attr('checked');
                jQuery('.chkb:not(:disabled)').attr('checked',false);
                jQuery(this).attr('checked', ischecked); 
            });        
        }      
    </script>
    
    <apex:form id="fm">
        <apex:actionFunction name="doDelete" action="{!doDelete}" immediate="true"/>
        <apex:actionFunction name="doView" action="{!view}" immediate="true"/>
        <apex:actionFunction name="doEdit" action="{!edit}" immediate="true"/>
        <apex:actionFunction name="doCancel" action="{!cancel}" immediate="true"/>
        <apex:actionFunction name="doListview" action="{!doListview}" immediate="true"/>
        <apex:actionFunction name="doSave" action="{!save}"/>
        <apex:actionFunction name="reloadPage" action="{!reloadPage}"  immediate="true"/>
        <apex:actionFunction name="processShipment" action="{!processShipment}" oncomplete="checkJobStatus()" rerender="pageMessages, op_JobStatus" immediate="true">
            <apex:param name="isReversal" assignTo="{!isReversal}" value="" />
        </apex:actionFunction>
<!-- RCB: 25029 -->                    
        <apex:actionFunction name="doProcessZenKraftShipment" action="{!processZenKraftShipment}" oncomplete="unblockUI();" rerender="pageMessages" />         
        <apex:stylesheet value="{!$Resource.rstk__ModalPopup_css}"/>
        <apex:includeScript value="{!$Resource.rstk__RowHandler_js}"/>
        <apex:includeScript value="{!$Resource.rstk__jquerytoolsoverlay}" />
        <apex:includeScript value="{!$Resource.rstk__hover_popup}" /> 
        <c:Popup popupId="containersDetailsPopupPage" title="{!$Label.rstk__pagebtn_soship_shippingcontainers}" cancelCaption="{!$Label.rstk__pagebtn_soship_close}" onCancel="reloadPage();">
                <iframe height="450px" width="100%" frameborder="0" src="/apex/SoshipContainerPopup?id={!shipperId}"></iframe>
        </c:Popup>
               
        <script>
            var saveAction = null;
            var savedBlockUI = null;
            var savedSaveAndNew = null;
            function doConfirmThenPageSave(actionFunction, blockuiMessage, saveAndNew)
            {
                saveAction = actionFunction;
                savedBlockUI = blockuiMessage;
                savedSaveAndNew = saveAndNew;
                _showDialog('confirmDeletions');
            }
            
            function confirmedPageSave() {
                doPageSave(saveAction, savedBlockUI, savedSaveAndNew);
            }
            
            function editSerialDetails(shiplineid) {
                soshiplineid = shiplineid;
                jQuery(".btnSerialDetails").click();
            }
            
            function component_close() {
                // Nothing to do on this case
            }
        </script>
        
        <button style="visibility:hidden" class="btnSerialDetails" rel="#winSerialDetails"></button>
        <div class="modal" id="winSerialDetails" style="width:700px;height:500px;">
            <h2>{!$Label.soship_Shipper_Line_Serial_Details}</h2>
            <div style="height:465px;scroll:auto;">
                <iframe id="SerialDetailsFrame" height="95%" width="100%" frameborder="0" src="about:blank">
                </iframe>
            </div>
            <button type="button" class="close" onclick="component_close()">{!$Label.rstk__pagebtn_soship_close}</button>
        </div>
                
        <apex:pageBlock id="pb" mode="detail">
            <apex:pageBlockButtons id="pb_buttons">
                <apex:commandButton onclick="{!IF(c.rstk__soship_packslip__c==null,'doPageSave','doConfirmThenPageSave')}();return false;"
                    value="{!$Label.rstk__soship_save}" rendered="{!isEditable}" style="width:50px"/>
                <c:standardButtons cntr="{!controller}" disableSave="true" disableDelete="true"/>
                <apex:outputPanel id="optionalButtons" rendered="{!!isNew}">
                <apex:commandButton value="{!$Label.rstk__pagebtn_soship_packingslip}" immediate="false" action="{!packingSlip}" disabled="{!isEditable}" onclick="showTopDialog('pleaseWaitPopup');" 
                    rerender="openscripts,soship_packslip__c" oncomplete="closeTopDialog(); openPackingSlip();"/>
<!-- RCB: 25029 -->                    
                <apex:commandButton onclick="blockUI(); doProcessZenKraftShipment(); return false;" value="{!$Label.rstk__pagebtn_soship_createzenkraftshipment}" rendered="{!isZenKraftEnabled}" style="width:150px" /> 
                <apex:commandButton action="{!processRevenovaLoad}" value="{!$Label.rstk__pagebtn_soship_createrevenovaload}" rendered="{!isRevenovaEnabled}" style="width:150px" disabled="{!isRevenovaGrayed}" />
                <input type="button" class="{!IF(isAutoContainerEnable,'btnDisabled','btn')}" value="{!IF(allContainersCreated,$Label.soship_Containers,$Label.Auto_Create_Containers)}" 
                    onclick="{!IF(isAutoContainerEnable,'', 'showContainerPopup();')}return false;"/>
                <input type="button" class="{!IF(OR(isEditable, !ISBLANK(c.soship_invoice__c)),'btnDisabled','btn')}" value="{!IF(c.soship_allshipped__c,$Label.Reverse_Shipment,$Label.Perform_Shipment)}" 
                    onclick="if(!{!OR(isEditable, !ISBLANK(c.soship_invoice__c))}){doProcessShipment({!c.soship_allshipped__c});}return false;" style="display:none;"/>
                <input type="button" class="{!IF(isManuContainerEnable,'btnDisabled','btn')}" value="{!$Label.rstk__pagebtn_soship_shippingcontainers}" 
                    onclick="{!IF(isManuContainerEnable,'', 'showShippingContainerPopup();')}return false;"/>    
                <apex:commandButton action="{!doRefresh}" value="{!$Label.rstk__pagebtn_poreceipt_refreshpage}" style="width:150px"/>
                <input type="button" class="{!IF(!(isZenKraftEnabled),'btnDisabled','btn')}" value="{!$Label.Print_Zenkraft_Labels}" 
                onclick="{!IF(!(isZenKraftEnabled),'','openPrintLabels();')}" style="{!IF(!(isZenKraftEnabled),'display:none;','')}" />                            
            <apex:outputPanel id="openscripts">
            <script>
        var templateOverride = {!templateOverride};
        var defaultTemplate = '{!defaultTemplate}';
                  function openPrintLabels() 
                  {
                      window.open('/apex/PrintZenkraftLabelsPage2?Id={!c.Id}');
                  } 
                
                  function showContainerPopup()
                  {
                    _showDialog('containersPopup');
                  }
                  function showShippingContainerPopup()
                  {
                    _showDialog('containersDetailsPopupPage',1000,550);
                    //jQuery(".btncontainersDetailsPopupPage").click();
                  }
                  function openPackingSlip()
                  {
                    if (templateOverride) {
                        if (defaultTemplate) {
                            jQuery('select[id$=selected_template__c]').val(defaultTemplate);
                        }
                        _showDialog('selectEmailTemplate');
                        return false;
                    } else {
                    //RSTK-1274
                    	if(isRootDox){
	                    	window.open('/apex/printDOX?oid={!c.soship_packslip__c}' 
	                        + (defaultTemplateForDox != '' ? '&t=' + defaultTemplateForDox :''), "{!f.soship_packslip__c.label}");
	                    }else{
	                        window.open("/apex/sopackprint?Id={!c.soship_packslip__c}", "{!f.soship_packslip__c.label}");
	                    }
                     }
                  }
                
                function template_ok() {
                    var packTemplate = jQuery('select[id$=selected_template__c]').val();
                    // RSTK-1274
                    if(isRootDox){
                    	window.open('/apex/printDOX?oid={!c.soship_packslip__c}' 
                        + (packTemplate != '' ? '&t=' + packTemplate :''), "{!f.soship_packslip__c.label}");
                    }else{
                    	window.open('/apex/sopackprint?id={!c.soship_packslip__c}' 
                        + (packTemplate != '' ? '&t=' + packTemplate :''), "{!f.soship_packslip__c.label}");
                    }
                    
                }

                  function doProcessShipment(isReversal) {
                    blockUI(isReversal ? "{!$Label.Reversing_shipment}" : "{!$Label.Performing_shipment}");
                    processShipment(isReversal);
                  }
                  function doAfterJobComplete(pl) {
                    if(pl.iserror__c) {
                        unblockUI();
                    } else {
                        window.location.replace(window.location);
                    }
                  }
                
            </script>
            </apex:outputPanel>
               </apex:outputPanel>
          </apex:pageBlockButtons>
          
          <c:Popup popupId="soshipchgpopup" title="{!$Label.rstk__shipping_charge_detail}" onOk="{!IF(c.rstk__soship_invoice__c == null,'soshipchg_saveAndClose();', '')}" buttonsOnTop="true">
            <apex:outputText value="{!$Label.rstk__note_that_adding_shipping_charge_detail_replaces_any_charges_entered_on_the_sale}"></apex:outputText> 
            <c:FrameGrid jsController="soshipchg" popupId="1" height="380px" onload="soshipchgLoaded();" page="/apex/SoshipChgPopUp" rootId="{!Id}"/>
          </c:Popup>
          <script>
              function soshipchgLoaded(){
                 soshipchg.validate = function() {
                    var self = this;
                    var valid = true;
                    self.getSelectableRows().each(function (index, el) {
                        var row = jQuery(this);
                        if (isEmpty(self.getRowValue(row, 'soshipchg_packageid__c'))) {
                            alert("{!$Label.Please_enter_required_field_Package_ID}");
                            valid = false;
                        }
                        if (isEmpty(self.getRowValue(row, 'soshipchg_frtamt__c')) || toNumber(self.getRowValue(row, 'soshipchg_frtamt__c')) < 0) {
                            alert("{!$Label.Freight_Charge_cannot_be_less_than_zero_0}");
                            valid = false;
                        }
                        if (isEmpty(self.getRowValue(row, 'soshipchg_handamt__c')) || toNumber(self.getRowValue(row, 'soshipchg_handamt__c')) < 0) {
                            alert("{!$Label.Handling_Charge_cannot_be_less_than_zero_0}");
                            valid = false;
                        }
                        if (isEmpty(self.getRowValue(row, 'soshipchg_packageamt__c')) || toNumber(self.getRowValue(row, 'soshipchg_packageamt__c')) < 0) {
                            alert("{!$Label.Packaging_Charge_cannot_be_less_than_zero_0}");
                            valid = false;
                        }
                        if (isEmpty(self.getRowValue(row, 'soshipchg_weight__c')) || toNumber(self.getRowValue(row, 'soshipchg_weight__c')) < 0) {
                            alert("{!$Label.Weight_cannot_be_less_than_zero_0}");
                            valid = false;
                        }
                        if (isEmpty(self.getRowValue(row, 'soshipchg_width__c')) || toNumber(self.getRowValue(row, 'soshipchg_width__c')) < 0) {
                            alert("{!$Label.Width_cannot_be_less_than_zero_0}");
                            valid = false;
                        }
                        if (isEmpty(self.getRowValue(row, 'soshipchg_length__c')) || toNumber(self.getRowValue(row, 'soshipchg_length__c')) < 0) {
                            alert("{!$Label.Length_cannot_be_less_than_zero_0}");
                            valid = false;
                        }
                        if (isEmpty(self.getRowValue(row, 'soshipchg_height__c')) || toNumber(self.getRowValue(row, 'soshipchg_height__c')) < 0) {
                            alert("{!$Label.Height_cannot_be_less_than_zero_0}");
                            valid = false;
                        }
                    });
                   return valid;
                }
             } 
             
             
          </script>  
            <apex:outputPanel style="display:none" />
            <apex:outputPanel id="op_JobStatus">
                <input type="hidden" id="processlogId" value="{!processlogId}"/>
            </apex:outputPanel>
            
        <div style="float:left;width:20%">
        <apex:outputPanel >
            <apex:image value="{!CustomerImage}" width="100px" alt="Logo"/>
        </apex:outputPanel>
        <apex:outputPanel rendered="{!isNew}">
          <h2 style="font-weight:bold;font-size:200%">{!$Label.rstk__shipper_entries_cannot_be_manually_created}</h2>
        </apex:outputPanel>
        </div>
        
        <div style="float:left;width:80%">
            <apex:pageBlockSection id="pbs_Main" showHeader="false" title="{!$Label.rstk__information}" columns="2" >
                <apex:pageBlockSectionItem helpText="{!f_so.rstk__sohdr_div__c.inlineHelpText}" rendered="{!!ISNULL(c.rstk__soship_order__c)}">
                    <apex:outputLabel value="{!f_so.rstk__sohdr_div__c.label}"/>
                    <apex:outputField value="{!c.soship_order__r.rstk__sohdr_div__c}"/>
                </apex:pageBlockSectionItem>
                
                <apex:pageBlockSectionItem />
                
                <apex:pageBlockSectionItem helpText="{!f.rstk__soship_order__c.inlineHelpText}" rendered="{!!ISNULL(c.rstk__soship_order__c)}">
                    <apex:outputLabel value="{!f.rstk__soship_order__c.label}"/>
                    <c:inputField id="soship_order__c" editable="false" cntr="{!controller}" width="300px"/>
                </apex:pageBlockSectionItem>
                
                <apex:pageBlockSectionItem />
                
                <apex:pageBlockSectionItem helpText="{!f.rstk__soship_shipper__c.inlineHelpText}">
                    <apex:outputLabel value="{!f.rstk__soship_shipper__c.label}"/>
                    <apex:outputField value="{!c.rstk__soship_shipper__c}"/>
                </apex:pageBlockSectionItem>
                
                <apex:pageBlockSectionItem helpText="{!f.rstk__soship_invoice__c.inlineHelpText}">
                    <apex:outputLabel value="{!f.rstk__soship_invoice__c.label}"/>
                    <apex:outputField value="{!c.rstk__soship_invoice__c}"/>
                </apex:pageBlockSectionItem>
                
                <apex:pageBlockSectionItem helpText="{!f.rstk__soship_custno__c.inlineHelpText}">
                    <apex:outputLabel value="{!f.rstk__soship_custno__c.label}"/>
                    <apex:outputField value="{!c.rstk__soship_custno__c}"/>
                </apex:pageBlockSectionItem>
                
                <apex:pageBlockSectionItem helpText="{!f.rstk__soship_asnsent__c.inlineHelpText}">
                    <apex:outputLabel value="{!f.rstk__soship_asnsent__c.label}"/>
                    <c:inputField id="soship_asnsent__c" cntr="{!controller}" tabIndex="1" editable="{!isEdit}"/>
                </apex:pageBlockSectionItem>
                
                <apex:pageBlockSectionItem helpText="{!f.rstk__soship_tracking__c.inlineHelpText}">
                    <apex:outputLabel value="{!f.rstk__soship_tracking__c.label}"/>
                    <apex:outputPanel >
                        <apex:outputPanel rendered="{!AND(NOT(ISNULL(trackingUrl)),NOT(isEdit))}">
                            <apex:outputLink value="{!trackingUrl}">{!c.rstk__soship_tracking__c}</apex:outputLink>
                        </apex:outputPanel>
                        <apex:outputPanel rendered="{!OR(ISNULL(trackingUrl),isEdit)}">
                            <c:inputField id="soship_tracking__c" cntr="{!controller}" tabIndex="2" editable="{!isEdit}"/>
                        </apex:outputPanel>
                    </apex:outputPanel>
                </apex:pageBlockSectionItem> 
                
                <apex:pageBlockSectionItem helpText="{!f.rstk__soship_closed__c.inlineHelpText}">
                    <apex:outputLabel value="{!f.rstk__soship_closed__c.label}"/>
                    <c:inputField id="soship_closed__c" cntr="{!controller}" tabIndex="3" editable="{!isEdit}"/>
                </apex:pageBlockSectionItem>
                
                <apex:pageBlockSectionItem helpText="{!f_rma.rstk__sorma_div__c.inlineHelpText}" rendered="{!!ISNULL(c.rstk__soship_sorma__c)}">
                    <apex:outputLabel value="{!f_rma.rstk__sorma_div__c.label}"/>
                    <apex:outputField value="{!c.soship_sorma__r.rstk__sorma_div__c}"/>
                </apex:pageBlockSectionItem>
                
                <apex:pageBlockSectionItem helpText="{!f.rstk__soship_sorma__c.inlineHelpText}" rendered="{!!ISNULL(c.rstk__soship_sorma__c)}">
                    <apex:outputLabel value="{!f.rstk__soship_sorma__c.label}"/>
                    <apex:outputField value="{!c.rstk__soship_sorma__c}"/>
                </apex:pageBlockSectionItem>
            </apex:pageBlockSection>
        </div>

        <br style="clear:both" />
            <apex:pageBlockSection id="pbs_Additional" showHeader="true"
                collapsible="true" title="{!$Label.rstk__additional}" columns="1">
                <apex:tabPanel switchType="client" selectedTab="address"
                    id="tabPanel">
                    <apex:tab label="{!$Label.rstk__pagetab_soship_address}" name="address" id="address">

                        <apex:pageBlockSection showHeader="false" collapsible="false"
                            title="{!$Label.rstk__address}" columns="2">
                            <apex:pageBlockSectionItem helpText="{!f.rstk__soship_address1__c.inlineHelpText}">
                                <apex:outputLabel value="{!f.rstk__soship_address1__c.label}" />
                                <c:inputField id="soship_address1__c" cntr="{!controller}"
                                    tabIndex="21" editable="{!EditableAndNoInvoiceSet}"/>
                            </apex:pageBlockSectionItem>
                            <apex:pageBlockSectionItem helpText="{!f.rstk__soship_name__c.inlineHelpText}">
                                <apex:outputLabel value="{!f.rstk__soship_name__c.label}" />
                                <c:inputField id="soship_name__c" cntr="{!controller}"
                                    tabIndex="30" editable="{!EditableAndNoInvoiceSet}"/>
                            </apex:pageBlockSectionItem>

                            <apex:pageBlockSectionItem helpText="{!f.rstk__soship_address2__c.inlineHelpText}">
                                <apex:outputLabel value="{!f.rstk__soship_address2__c.label}" />
                                <c:inputField id="soship_address2__c" cntr="{!controller}"
                                    tabIndex="22" editable="{!EditableAndNoInvoiceSet}"/>
                            </apex:pageBlockSectionItem>
                            <apex:pageBlockSectionItem helpText="{!f.rstk__soship_phone__c.inlineHelpText}">
                                <apex:outputLabel value="{!f.rstk__soship_phone__c.label}" />
                                <c:inputField id="soship_phone__c" cntr="{!controller}"
                                    tabIndex="31" editable="{!EditableAndNoInvoiceSet}"/>
                            </apex:pageBlockSectionItem>

                            <apex:pageBlockSectionItem helpText="{!f.rstk__soship_address3__c.inlineHelpText}">
                                <apex:outputLabel value="{!f.rstk__soship_address3__c.label}" />
                                <c:inputField id="soship_address3__c" cntr="{!controller}"
                                    tabIndex="23" editable="{!EditableAndNoInvoiceSet}"/>
                            </apex:pageBlockSectionItem>
                            <apex:pageBlockSectionItem helpText="{!f.rstk__soship_fax__c.inlineHelpText}">
                                <apex:outputLabel value="{!f.rstk__soship_fax__c.label}" />
                                <c:inputField id="soship_fax__c" cntr="{!controller}"
                                    tabIndex="32" editable="{!EditableAndNoInvoiceSet}"/>
                            </apex:pageBlockSectionItem>

                            <apex:pageBlockSectionItem helpText="{!f.rstk__soship_city__c.inlineHelpText}">
                                <apex:outputLabel value="{!f.rstk__soship_city__c.label}" />
                                <c:inputField id="soship_city__c" cntr="{!controller}"
                                    tabIndex="24" editable="{!EditableAndNoInvoiceSet}"/>
                            </apex:pageBlockSectionItem>
                            <apex:pageBlockSectionItem helpText="{!f.rstk__soship_email__c.inlineHelpText}">
                                <apex:outputLabel value="{!f.rstk__soship_email__c.label}" />
                                <c:inputField id="soship_email__c" cntr="{!controller}"
                                    tabIndex="33" editable="{!EditableAndNoInvoiceSet}"/>
                            </apex:pageBlockSectionItem>

                            <apex:pageBlockSectionItem helpText="{!f.rstk__soship_state__c.inlineHelpText}">
                                <apex:outputLabel value="{!f.rstk__soship_state__c.label}" />
                                <c:inputField id="soship_state__c" cntr="{!controller}"
                                    tabIndex="25" editable="{!EditableAndNoInvoiceSet}"/>
                            </apex:pageBlockSectionItem>

                            <apex:pageBlockSectionItem helpText="{!f.rstk__soship_contact__c.inlineHelpText}">
                                <apex:outputLabel value="{!f.rstk__soship_contact__c.label}" />
                                <c:inputField id="soship_contact__c" cntr="{!controller}"
                                    tabIndex="34" editable="{!EditableAndNoInvoiceSet}"/>
                            </apex:pageBlockSectionItem>
                            
                            <apex:pageBlockSectionItem helpText="{!f.rstk__soship_country__c.inlineHelpText}">
                                <apex:outputLabel value="{!f.rstk__soship_country__c.label}" />
                                <apex:panelGrid columns="2">
                                    <c:inputField id="soship_country__c" cntr="{!controller}"
                                    tabIndex="26" editable="{!EditableAndNoInvoiceSet}"/>
                                    <!--c:inputField id="soship_isocountry__c" cntr="{!controller}" onchange="isocountryChanged();" rendered="{!EditableAndNoInvoiceSet}"/-->
                                    <apex:inputField id="soship_isocountry__c" value="{!c.rstk__soship_isocountry__c}" onchange="isocountryChanged();" rendered="{!EditableAndNoInvoiceSet}"/>
                                </apex:panelGrid>    
                            </apex:pageBlockSectionItem>
                            
                            <apex:pageBlockSectionItem helpText="{!f.rstk__soship_conmethod__c.inlineHelpText}">
                                <apex:outputLabel value="{!f.rstk__soship_conmethod__c.label}" />
                                <c:inputField id="soship_conmethod__c" cntr="{!controller}"
                                    tabIndex="35" editable="{!EditableAndNoInvoiceSet}"/>
                            </apex:pageBlockSectionItem>
                            
                            <apex:pageBlockSectionItem helpText="{!f.rstk__soship_zip__c.inlineHelpText}">
                                <apex:outputLabel value="{!f.rstk__soship_zip__c.label}" />
                                <c:inputField id="soship_zip__c" cntr="{!controller}"
                                    tabIndex="27" editable="{!EditableAndNoInvoiceSet}"/>
                            </apex:pageBlockSectionItem>

                            <apex:pageBlockSectionItem helpText="{!f.rstk__soship_sydivaddr__c.inlineHelpText}">
                                <apex:outputLabel value="{!f.rstk__soship_sydivaddr__c.label}" />
                                <c:selectList id="soship_sydivaddr__c" cntr="{!controller}" options="{!shipAddresses}" tabIndex="36" editable="{!EditableAndNoInvoiceSet}"/>
                            </apex:pageBlockSectionItem>

                            <apex:pageBlockSectionItem helpText="{!f.rstk__soship_vatexempt__c.inlineHelpText}" rendered="{!vatActive}">
                                <apex:outputLabel value="{!f.rstk__soship_vatexempt__c.label}"/>
                                <c:inputField id="soship_vatexempt__c" cntr="{!controller}"
                                    tabIndex="37" editable="{!EditableAndNoInvoiceSet}"/>
                            </apex:pageBlockSectionItem>

                        </apex:pageBlockSection>

                    </apex:tab>
                    <apex:tab label="{!$Label.rstk__pagetab_soship_charges}" name="charges" id="charges">
                        <apex:pageBlockSection showHeader="false" collapsible="false"
                            title="{!$Label.rstk__charges}" columns="3">
                            <apex:pageBlockSectionItem helpText="{!f.rstk__soship_sumfrt__c.inlineHelpText}">
                                <apex:outputLabel value="{!f.rstk__soship_sumfrt__c.label}" />
                                <c:inputField id="soship_sumfrt__c" cntr="{!controller}"
                                    tabIndex="41" editable="{!EditableAndNoInvoiceSet}" onchange="sh_enableInputs()"/>
                            </apex:pageBlockSectionItem>
                            <apex:pageBlockSectionItem helpText="{!f.rstk__soship_freightamt__c.inlineHelpText}">
                                <apex:outputLabel value="{!f.rstk__soship_freightamt__c.label}" />
                                <c:inputField id="soship_freightamt__c" cntr="{!controller}"
                                    tabIndex="44" editable="{!EditableAndNoInvoiceSet}"/>
                            </apex:pageBlockSectionItem>
                            <apex:pageBlockSectionItem helpText="{!f.rstk__soship_taxfreight__c.inlineHelpText}">
                                <apex:outputLabel value="{!f.rstk__soship_taxfreight__c.label}" />
                                <c:inputField id="soship_taxfreight__c" cntr="{!controller}"
                                    tabIndex="47" editable="{!EditableAndNoInvoiceSet}"/>
                            </apex:pageBlockSectionItem>
                            
                            <apex:pageBlockSectionItem helpText="{!f.rstk__soship_sumhand__c.inlineHelpText}">
                                <apex:outputLabel value="{!f.rstk__soship_sumhand__c.label}" />
                                <c:inputField id="soship_sumhand__c" cntr="{!controller}"
                                    tabIndex="42" editable="{!EditableAndNoInvoiceSet}" onchange="sh_enableInputs()"/>
                            </apex:pageBlockSectionItem>
                            <apex:pageBlockSectionItem helpText="{!f.rstk__soship_handlingamt__c.inlineHelpText}">
                                <apex:outputLabel value="{!f.rstk__soship_handlingamt__c.label}" />
                                <c:inputField id="soship_handlingamt__c" cntr="{!controller}"
                                    tabIndex="45" editable="{!EditableAndNoInvoiceSet}"/>
                            </apex:pageBlockSectionItem>
                            <apex:pageBlockSectionItem helpText="{!f.rstk__soship_taxhandling__c.inlineHelpText}">
                                <apex:outputLabel value="{!f.rstk__soship_taxhandling__c.label}" />
                                <c:inputField id="soship_taxhandling__c" cntr="{!controller}"
                                    tabIndex="48" editable="{!EditableAndNoInvoiceSet}"/>
                            </apex:pageBlockSectionItem>
                            
                            <apex:pageBlockSectionItem helpText="{!f.rstk__soship_sumpackage__c.inlineHelpText}">
                                <apex:outputLabel value="{!f.rstk__soship_sumpackage__c.label}" />
                                <c:inputField id="soship_sumpackage__c" cntr="{!controller}"
                                    tabIndex="43" editable="{!EditableAndNoInvoiceSet}" onchange="sh_enableInputs()"/>
                            </apex:pageBlockSectionItem>
                            <apex:pageBlockSectionItem helpText="{!f.rstk__soship_packageamt__c.inlineHelpText}">
                                <apex:outputLabel value="{!f.rstk__soship_packageamt__c.label}" />
                                <c:inputField id="soship_packageamt__c" cntr="{!controller}"
                                    tabIndex="46" editable="{!EditableAndNoInvoiceSet}"/>
                            </apex:pageBlockSectionItem>
                            <apex:pageBlockSectionItem helpText="{!f.rstk__soship_taxpackaging__c.inlineHelpText}">
                                <apex:outputLabel value="{!f.rstk__soship_taxpackaging__c.label}" />
                                <c:inputField id="soship_taxpackaging__c" cntr="{!controller}"
                                    tabIndex="49" editable="{!EditableAndNoInvoiceSet}"/>
                            </apex:pageBlockSectionItem>
                            
<script>
                function sh_getTab()
                {
                    return jQuery("#"+escapeId("{!$Component.shipping}"));
                }
                
                function sh_enableEl(el, doEnable)
                {
                  if (doEnable)
                  {
                    el.removeAttr('disabled');
                  }
                  else
                  {
                    el.attr('disabled', 'disabled');
                  }
                }

                function sh_enableInputs()
                {
                    var tab= sh_getTab();
                    
                    var sumFrt = tab.find('input[name*="soship_sumfrt__c"]:checked');
                    var sumHnd = tab.find('input[name*="soship_sumhand__c"]:checked');
                    var sumPkg = tab.find('input[name*="soship_sumpackage__c"]:checked');

                    var inpFrt = tab.find('input[name*="soship_freightamt__c"]');
                    var inpHnd = tab.find('input[name*="soship_handlingamt__c"]');
                    var inpPkg = tab.find('input[name*="soship_packageamt__c"]');
                    
                    sh_enableEl(inpFrt, (sumFrt.size() == 0));
                    sh_enableEl(inpHnd, (sumHnd.size() == 0));
                    sh_enableEl(inpPkg, (sumPkg.size() == 0));
                }
                sh_enableInputs();
</script>
                        </apex:pageBlockSection>
                        
                        
                    </apex:tab>
                    <apex:tab label="{!$Label.rstk__pagetab_soship_shipping}" name="shipping" id="shipping">
                    
                        <apex:pageBlockSection showHeader="false" collapsible="false"
                            title="{!$Label.rstk__shipping}" columns="1">
                            <apex:pageBlockSectionItem helpText="{!f.rstk__soship_carrier__c.inlineHelpText}">
                                <apex:outputLabel value="{!f.rstk__soship_carrier__c.label}"/>
                                <c:selectList id="soship_carrier__c" cntr="{!controller}" options="{!carriers}" width="300px" editable="{!EditableAndNoInvoiceSet}" tabIndex="61"/>
                            </apex:pageBlockSectionItem>
                                                            
                            <apex:pageBlockSectionItem helpText="{!f.rstk__soship_fob__c.inlineHelpText}">
                                <apex:outputLabel value="{!f.rstk__soship_fob__c.label}"/>
                                <c:selectList id="soship_fob__c" cntr="{!controller}" options="{!fobs}" width="300px" editable="{!EditableAndNoInvoiceSet}" tabIndex="62"/>
                            </apex:pageBlockSectionItem>
                              
                            <apex:pageBlockSectionItem helpText="{!f.rstk__soship_fterms__c.inlineHelpText}">
                                <apex:outputLabel value="{!f.rstk__soship_fterms__c.label}"/>
                                <c:selectList id="soship_fterms__c" cntr="{!controller}" options="{!freightTerms}" width="300px" editable="{!EditableAndNoInvoiceSet}" tabIndex="63"/>
                            </apex:pageBlockSectionItem> 
                              
                            <apex:pageBlockSectionItem helpText="{!f.rstk__soship_shipvia__c.inlineHelpText}">
                                <apex:outputLabel value="{!f.rstk__soship_shipvia__c.label}"/>
                                <c:selectList id="soship_shipvia__c" cntr="{!controller}" options="{!shipmethods}" width="300px" editable="{!EditableAndNoInvoiceSet}" tabIndex="64"/>
                            </apex:pageBlockSectionItem>

                            <apex:pageBlockSectionItem helpText="{!f.rstk__soship_usechargedtl__c.inlineHelpText}">
                                <apex:outputLabel value="{!f.rstk__soship_usechargedtl__c.label}"/>
                                <c:inputField id="soship_usechargedtl__c" cntr="{!controller}" tabIndex="65"/>
                            </apex:pageBlockSectionItem>
                            
                            <apex:pageBlockSectionItem helpText="{!f.rstk__soship_usecustcarr__c.inlineHelpText}">
                                <apex:outputLabel value="{!f.rstk__soship_usecustcarr__c.label}" />
                                <c:inputField id="soship_usecustcarr__c" cntr="{!controller}"
                                    tabIndex="66" editable="{!EditableAndNoInvoiceSet}"/>
                            </apex:pageBlockSectionItem>
                            
                            <apex:pageBlockSectionItem helpText="{!f.rstk__soship_custcarracct__c.inlineHelpText}">
                                <apex:outputLabel value="{!f.rstk__soship_custcarracct__c.label}"/>
                                <c:inputField id="soship_custcarracct__c" cntr="{!controller}" tabIndex="67"/>
                            </apex:pageBlockSectionItem>

                            <apex:pageBlockSectionItem >
                               <apex:outputPanel >
                                    <apex:commandbutton value="{!$Label.rstk__pagebtn_soship_shippingchargedetail}" onclick="_showDialog('soshipchgpopup',1200);return false;" style="width:140px;" rendered="{!AND(isView,c.rstk__soship_usechargedtl__c)}"/>
                                </apex:outputPanel>
                            </apex:pageBlockSectionItem>
                            
                            <apex:pageBlockSectionItem helpText="{!f.rstk__soship_loadid__c.inlineHelpText}" rendered="{!isRevenovaEnabled}">
                                <apex:outputLabel value="{!f.rstk__soship_loadid__c.label}"/>
                                <a target="_blank" href="/{!c.soship_loadid__c}">{!loadIdName}</a>
                            </apex:pageBlockSectionItem>
                            <apex:pageBlockSectionItem />

                        </apex:pageBlockSection>
                    </apex:tab>
                    <apex:tab label="{!customFieldTabName}" name="tab_Custom" id="tab_Custom" rendered="{!hasCustomFields}">
                        <c:customFields cntr="{!controller}" cols="2"/>
                    </apex:tab>
                </apex:tabPanel>

            </apex:pageBlockSection>


             <apex:pageBlockSection id="pbs_shipLineDetails" showHeader="true" collapsible="false" title="{!$Label.rstk__pagetab_soship_shipperlines}" columns="1">
             <apex:outputPanel id="op_SOShip">
			<apex:actionRegion >
                 <apex:outputPanel >
                 <input type="button" class="btn" id="sd_removeSelected" value="{!$Label.pagebtn_soship_DeleteSelected}"  onclick="sd.deleteShipperLines()"/>
                 <apex:actionFunction name="sd_updateShipLines" action="{!updateShipLines}" immediate="false" rerender="ds_infoBlock" oncomplete="sd.saveAndRun(null)"/>
                 </apex:outputPanel>
<!-- ======================================================================
     <<<<<<< SHIP LINE TABLE
     ====================================================================== -->
			     
			        <apex:pageBlockTable id="shipLineDetails" value="{!shipLines}" var="d">
			             <apex:column headerValue="" rendered="{!EditableAndNoInvoiceSet}">
			                 <apex:facet name="header">
			                    <a href="#" onclick="sd.selectAll(); return false;">{!$Label.rstk__soship_sel}</a>
			                 </apex:facet>
			                 <apex:outputPanel rendered="{!d.canBeDeleted}">
			                    <apex:inputCheckbox id="rowSelected" value="{!d.selected}" onchange="sd.rowChanged(event);sd.enableOptionalButtons()"/>
			                 </apex:outputPanel>
			                 <apex:outputPanel rendered="{!!d.canBeDeleted}">
			                    <c:HelpLabel helpText="{!d.cannotBeDeletedReason}"/>
			                 </apex:outputPanel>
			             </apex:column>
			             
			             <apex:column headerValue="{!f_el.rstk__soshipline_line__c.label}">
			                 <apex:inputHidden id="idx" value="{!d.idx}"/>
			                 <apex:inputHidden id="state" value="{!d.state}"/>
			                 <apex:outputField value="{!d.shipLine.name}"/>
			             </apex:column>
			             
			             <apex:column headerValue="{!f_el.rstk__soshipline_prod__c.label}">
			                 <apex:outputField value="{!d.shipLine.rstk__soshipline_prod__c}"/>
			             </apex:column>
			             
			             <apex:column headerValue="{!f_el.rstk__soshipline_uom__c.label}">
			                 <apex:outputField value="{!d.shipLine.rstk__soshipline_uom__c}"/>
			             </apex:column>
			
			             <apex:column headerValue="{!f_el.rstk__soshipline_qtypackage__c.label}">
			                 <apex:outputField value="{!d.shipLine.rstk__soshipline_qtypackage__c}"/>
			             </apex:column>
			             
			             <apex:column headerValue="{!f_el.rstk__soshipline_qtyship__c.label}">
			                 <apex:outputField value="{!d.shipLine.rstk__soshipline_qtyship__c}"/>
			             </apex:column>
			                                 
			             <apex:column headerValue="{!f_el.rstk__soshipline_freightamt__c.label}">
			                 <apex:outputField value="{!d.shipLine.rstk__soshipline_freightamt__c}" rendered="{!!EditableAndNoInvoiceSet}"/>
			                 <apex:inputField value="{!d.shipLine.rstk__soshipline_freightamt__c}" onchange="sd.rowChanged(event,true);" rendered="{!EditableAndNoInvoiceSet}"/>
			             </apex:column>
			                                 
			             <apex:column headerValue="{!f_el.rstk__soshipline_handlingamt__c.label}">
			                 <apex:outputField value="{!d.shipLine.rstk__soshipline_handlingamt__c}" rendered="{!!EditableAndNoInvoiceSet}"/>
			                 <apex:inputField value="{!d.shipLine.rstk__soshipline_handlingamt__c}" onchange="sd.rowChanged(event,true);" rendered="{!EditableAndNoInvoiceSet}"/>
			             </apex:column>
			                                 
			             <apex:column headerValue="{!f_el.rstk__soshipline_packageamt__c.label}">
			                 <apex:outputField value="{!d.shipLine.rstk__soshipline_packageamt__c}" rendered="{!!EditableAndNoInvoiceSet}"/>
			                 <apex:inputField value="{!d.shipLine.rstk__soshipline_packageamt__c}" onchange="sd.rowChanged(event,true);" rendered="{!EditableAndNoInvoiceSet}"/>
			             </apex:column>
			
			             <apex:column headerValue="">
			                 <c:nosubmitbutton label="{!$Label.rstk__pagebtn_soship_serialdetails}" onclick="editSerialDetails('{!d.shipLine.id}');" rendered="{!d.hasSerials}"/>
			             </apex:column>
			          </apex:pageBlockTable>
			          
			          <apex:panelGrid columns="6">
			             <apex:commandLink status="fetchStatusSOShip" reRender="op_SOShip" action="{!firstPage}">First</apex:commandlink>
			             <apex:commandLink status="fetchStatusSOShip" reRender="op_SOShip" action="{!previousPage}" rendered="{!setConSoShip.hasPrevious}">Previous</apex:commandlink>
			             <apex:commandLink status="fetchStatusSOShip" reRender="op_SOShip" action="{!nextPage}" rendered="{!setConSoShip.hasNext}">Next</apex:commandlink>
			             <apex:commandLink status="fetchStatusSOShip" reRender="op_SOShip" action="{!lastPage}">Last</apex:commandlink>
			             <apex:outputText >{!(setConSoShip.pageNumber * pagesize)+1-pagesize}-{!IF((setConSoShip.pageNumber * pagesize)>noOfRecords, noOfRecords,(setConSoShip.pageNumber * pagesize))} of {!noOfRecords}</apex:outputText>
			             <apex:outputPanel style="color:#4AA02C;font-weight:bold">
			                 <apex:actionStatus id="fetchStatusSOShip" startText="Fetching..." stopText=""/>
			             </apex:outputPanel>
			         </apex:panelGrid>
			     	</apex:actionRegion>
			     </apex:outputPanel>      
               
				
             </apex:pageBlockSection>
        <script>
            var SDHandler = function(){};
            SDHandler.prototype = new RowHandlerBase();
                                   
            SDHandler.prototype.deleteShipperLines = function() {
                  this.saveAndRun(function() {_showDialog('deleteShiplinesPopup', '800px'); });
                };
            
            var sd = new SDHandler(); 
            sd.init("{!$Component.pbs_shipLineDetails.shipLineDetails}:tb", sd_updateShipLines, "sd_removeSelected");
        </script>
<!-- ======================================================================
     SHIP LINE TABLE >>>>>>>>>>>>
     ====================================================================== -->     
     
<!-- ======================================================================
     <<<<<<< DELETE SHIP LINES
     ====================================================================== -->      
           <apex:outputPanel >
              <div id="deleteShiplinesPopup" style="display:none">
                 <apex:outputPanel styleClass="popupBackground" layout="block"/>
                 <apex:outputPanel styleClass="modalPopup">
                 <apex:actionFunction name="ds_deleteShipLines" action="{!deleteShipLines}" immediate="true" reRender="ds_infoBlock,pbs_shipLineDetails" oncomplete="closeTopDialog();"/>
                    <apex:pageBlockSection showHeader="true" collapsible="false" title="{!$Label.rstk__pagetab_soship_deleteshiplines}" columns="1">
                    <apex:outputPanel id="ds_infoBlock">
                       <apex:pageBlockSection id="shpb" showHeader="false" collapsible="false" title="{!$Label.rstk__pagetab_soship_deleteshiplines}" columns="1">
                            <apex:pageBlockSectionItem rendered="{!deleteShipLinesStatus.state != SHState_NOTRUN}">
                                <apex:outputLabel value="{!$Label.rstk__results}"/>
                                <apex:outputText value="{!deleteShipLinesStatus.results}"/>
                            </apex:pageBlockSectionItem>

                            <apex:pageBlockSectionItem rendered="{!deleteShipLinesStatus.state == SHState_NOTRUN}">
                                <apex:outputLabel value="{!$Label.rstk__pleaseconfirm}"/>
                                <apex:outputPanel >
                                    <apex:outputPanel >
                                       {!$Label.rstk__that_the_shipper_lines_marked_for_deletion_are_now_to_be_removed}.
                                    </apex:outputPanel>
                                    <apex:outputPanel rendered="{!deleteShipLinesStatus.allSelected}">
                                       {!$Label.rstk__since_all_the_shipper_lines_are_being_removed_then_the_shipper_header_will_also}
                                    </apex:outputPanel>
                                </apex:outputPanel>
                            </apex:pageBlockSectionItem>

                            <apex:pageBlockSection id="sh_detailsSection" showHeader="true" collapsible="true" title="{!$Label.rstk__pagetab_soship_moredetails}" columns="1" rendered="{!deleteShipLinesStatus.hasLines}">
                                 <script>twistSection(document.getElementById("{!$Component.sh_detailsSection}").childNodes[0].childNodes[0]); </script>
                                <apex:pageBlockTable value="{!deleteShipLinesStatus.lines}" var="d">
                                    <apex:column headerValue="{!$Label.rstk__level}">
                                        <apex:outputText style="font-weight:800;" value="{!d.level}"/>
                                    </apex:column>
                                    <apex:column headerValue="{!$Label.rstk__item}">
                                        <apex:outputText value="{!d.item}"/>
                                    </apex:column>
                                    <apex:column headerValue="{!$Label.rstk__description}">
                                        <apex:outputText value="{!d.description}"/>
                                    </apex:column>
                                </apex:pageBlockTable>
                            </apex:pageBlockSection>


                            <apex:pageBlockSectionItem >
                              <apex:outputPanel >
                                 <apex:outputPanel rendered="{!deleteShipLinesStatus.state != SHState_NOTRUN}">
                                    <input type="button" class="btn" id="sh_ok" value="{!$Label.pagebtn_soship_Ok}" onclick="_closeDialog()"/>
                                 </apex:outputPanel>
                                 <apex:outputPanel rendered="{!deleteShipLinesStatus.state == SHState_NOTRUN}">
                                    <input type="button" class="btn" id="sh_confirmBtn" value="{!$Label.pagebtn_soship_Confirm}" onclick="showTopDialog('pleaseWaitPopup'); ds_deleteShipLines();"/>
                                    <input type="button" class="btn" id="sh_cancel" value="{!$Label.pagebtn_soship_Cancel}" onclick="_closeDialog()"/>
                                 </apex:outputPanel>
                             </apex:outputPanel>
                            </apex:pageBlockSectionItem>
                        </apex:pageBlockSection>
                    </apex:outputPanel>     
                   </apex:pageBlockSection>
                 </apex:outputPanel>     
              </div>
           </apex:outputPanel>
<!-- ======================================================================
     DELETE SHIP LINES >>>>>>>
     ====================================================================== -->    

<!-- ======================================================================
     <<<<<<< AUTO-CREATE CONTAINERS
     ====================================================================== -->      
           <apex:outputPanel >
              <div id="containersPopup" style="display:none">
                 <apex:outputPanel styleClass="popupBackground" layout="block"/>
                 <apex:outputPanel styleClass="modalPopup">
                 <apex:actionFunction name="cc_createContainers" action="{!createContainers}" immediate="true" reRender="cc_infoBlock,pbs_shipLineDetails,optionalButtons" oncomplete="closeTopDialog();"/>
                 <apex:actionFunction name="cc_resetStatus" action="{!resetContainerStatus}" immediate="true" reRender="cc_infoBlock,pbs_shipLineDetails,optionalButtons" oncomplete="closeTopDialog();"/>
                    <apex:pageBlockSection showHeader="true" collapsible="false" title="{!$Label.rstk__pagetab_soship_shippingcontainers}" columns="1">
                    <apex:outputPanel id="cc_infoBlock">
                      <apex:pageBlockSection id="ccpb" showHeader="false" collapsible="false" title="{!$Label.rstk__containers}" columns="1">
                    <apex:outputPanel rendered="{!allContainersCreated}">
 
    <!-- ======================================================================
         <<<<<<<< Container Table
         ======================================================================    -->
                 <apex:pageBlockTable id="containers" value="{!containers}" var="d">
                 
                    <apex:column headerValue="{!f_el.rstk__soshipline_shipper__c.label}">
                        <apex:outputField value="{!d.shipLine.rstk__soshipline_shipper__c}"/>
                    </apex:column>
                    
                     <apex:column headerValue="{!f_cel.rstk__socontainel_soshipline__c.label}">
                        <apex:outputField value="{!d.containel.rstk__socontainel_soshipline__c}"/>
                    </apex:column>
                    
                     <apex:column headerValue="{!f_cel.rstk__socontainel_socontainer__c.label}">
                        <apex:outputField value="{!d.containel.rstk__socontainel_socontainer__c}"/>
                    </apex:column>
                    
                     <apex:column headerValue="{!f_c.rstk__socontainer_sycarrier__c.label}">
                        <apex:outputField value="{!d.containel.socontainel_socontainer__r.rstk__socontainer_sycarrier__c}"/>
                    </apex:column>
                    
                     <apex:column headerValue="{!f_c.rstk__socontainer_shipdate__c.label}">
                        <apex:outputField value="{!d.containel.socontainel_socontainer__r.rstk__socontainer_shipdate__c}"/>
                    </apex:column>
                    
                     <apex:column headerValue="{!f_c.rstk__socontainer_tracking__c.label}">
                        <apex:outputLink value="{!d.trackingUrl}" rendered="{!!ISNULL(d.trackingUrl)}">{!d.containel.socontainel_socontainer__r.rstk__socontainer_tracking__c}</apex:outputLink>
                        <apex:outputField value="{!d.containel.socontainel_socontainer__r.rstk__socontainer_tracking__c}" rendered="{!ISNULL(d.trackingUrl)}"/>
                    </apex:column>

                 </apex:pageBlockTable>
    <!-- ======================================================================
         Container Table >>>>>>>
         ====================================================================== -->    

                    </apex:outputPanel>
                    <apex:outputPanel rendered="{!!allContainersCreated}">

                            <apex:pageBlockSectionItem rendered="{!createContainerStatus.state != SHState_NOTRUN}">
                                <apex:outputLabel value="{!$Label.rstk__results}"/>
                                <apex:outputText value="{!createContainerStatus.results}"/>
                            </apex:pageBlockSectionItem>

                            <apex:pageBlockSectionItem rendered="{!createContainerStatus.state == SHState_NOTRUN}">
                                <apex:outputLabel value="{!$Label.rstk__pleaseconfirm}"/>
                                <apex:outputPanel >
                                       {!$Label.rstk__that_you_want_to_have_the_system_automatically_create_shipping_containers_for_th}
                                </apex:outputPanel>
                            </apex:pageBlockSectionItem>

                            <apex:pageBlockSection id="cc_detailsSection" showHeader="true" collapsible="true" title="{!$Label.rstk__pagetab_soship_moredetails}" columns="1" rendered="{!createContainerStatus.hasLines}">
                                 <script>twistSection(document.getElementById("{!$Component.sh_detailsSection}").childNodes[0].childNodes[0]); </script>
                                <apex:pageBlockTable value="{!createContainerStatus.lines}" var="d">
                                    <apex:column headerValue="{!$Label.rstk__level}">
                                        <apex:outputText style="font-weight:800;" value="{!d.level}"/>
                                    </apex:column>
                                    <apex:column headerValue="{!$Label.rstk__item}">
                                        <apex:outputText value="{!d.item}"/>
                                    </apex:column>
                                    <apex:column headerValue="{!$Label.rstk__description}">
                                        <apex:outputText value="{!d.description}"/>
                                    </apex:column>
                                </apex:pageBlockTable>
                            </apex:pageBlockSection>
                    </apex:outputPanel>


                            <apex:pageBlockSectionItem >
                              <apex:outputPanel >
                                 <apex:outputPanel rendered="{!OR(createContainerStatus.state != SHState_NOTRUN, allContainersCreated)}">
                                    <input type="button" class="btn" id="cc_ok" value="{!$Label.pagebtn_soship_Ok}" onclick="_closeDialog();showTopDialog('pleaseWaitPopup');reloadPage()"/>
                                    <input type="button" class="btn" id="cc_reset" value="{!$Label.pagebtn_soship_ResetStatus}" onclick="showTopDialog('pleaseWaitPopup'); cc_resetStatus()"/>
                                 </apex:outputPanel>
                                 <apex:outputPanel rendered="{!AND(createContainerStatus.state == SHState_NOTRUN, NOT(allContainersCreated))}">
                                    <input type="button" class="btn" id="cc_confirmBtn" value="{!$Label.pagebtn_soship_Confirm}" onclick="showTopDialog('pleaseWaitPopup'); cc_createContainers();"/>
                                    <input type="button" class="btn" id="cc_cancel" value="{!$Label.pagebtn_soship_Cancel}" onclick="_closeDialog()"/>
                                 </apex:outputPanel>
                             </apex:outputPanel>
                            </apex:pageBlockSectionItem>
                        </apex:pageBlockSection>
                    </apex:outputPanel>     
                   </apex:pageBlockSection>
                 </apex:outputPanel>     
              </div>
           </apex:outputPanel>
<!-- ======================================================================
     AUTO-CREATE CONTAINERS >>>>>>>
     ====================================================================== -->    
    
<!-- ====================================================================== 

     <<<<<<< CONFIRM DELETIONS
     ====================================================================== -->      
           <apex:outputPanel >
              <div id="confirmDeletions" style="display:none">
                 <apex:outputPanel styleClass="popupBackground" layout="block"/>
                 <apex:outputPanel styleClass="modalPopup">
                    <apex:pageBlockSection showHeader="true" collapsible="false" title="{!$Label.rstk__pagetab_soship_confirmdeletion}" columns="1">

                            <apex:pageBlockSectionItem >
                                <apex:outputPanel >
                                       {!$Label.rstk__the_existing_packing_slip_may_now_contain_out_of_date_information_please_confir}
                                </apex:outputPanel>
                            </apex:pageBlockSectionItem>
                           <apex:pageBlockSectionItem >
                               <apex:outputLabel value="{!$Label.rstk__deletepackingslip}"/>
                               <apex:inputCheckbox value="{!deletePackingSlip}"/>
                            </apex:pageBlockSectionItem>


                            <apex:pageBlockSectionItem >
                              <apex:outputPanel >

                                    <input type="button" class="btn" value="{!$Label.pagebtn_soship_Ok}" onclick="_closeDialog();confirmedPageSave();"/>
                                    <input type="button" class="btn" value="{!$Label.pagebtn_soship_Cancel}" onclick="_closeDialog()"/>
                             </apex:outputPanel>
                            </apex:pageBlockSectionItem>
                        </apex:pageBlockSection>

                 </apex:outputPanel>     
              </div>            
           </apex:outputPanel>     
<!-- ======================================================================
     CONFIRM DELETIONS >>>>>>>
     ====================================================================== -->    

             <div id="pleaseWaitPopup" style="display:none">
                 <apex:outputPanel styleClass="topPopupBackground" layout="block"/>
                 <apex:outputPanel styleClass="topPopup">
                    <apex:image url="{!$Resource.rstk__busy}"/>
                 </apex:outputPanel>
             </div>

            <c:Popup popupId="selectEmailTemplate" title="{!$Label.rstk__pagepopup_soship_selectemailtemplate}" onOk="_closeDialog(); template_ok();">
                    <apex:selectList id="selected_template__c" style="width:300px" multiselect="false" size="1">
                        <apex:selectOptions value="{!EmailTemplates}"/>
                    </apex:selectList>
            </c:Popup>

            <apex:tabPanel switchType="client" selectedTab="tab_Custom" id="theTabPanel">
                <apex:tab label="{!$Label.rstk__pagetab_soship_info}" name="tab_Info" id="tab_Info">
                    <c:infoSection cntr="{!controller}" showHeader="false"/>
                </apex:tab>
            </apex:tabPanel>
        </apex:pageBlock>
    </apex:form>
            
        <!-- apex:outputPanel id="debug">
        <textarea rows='20' cols='200'>{!debug}</textarea>
        </apex:outputPanel -->
    <apex:relatedList list="soship_socontainer__r"/>
    <apex:relatedList list="UPS_Shipments__r" rendered="{!packageEnabled.zkUPS}"/>
    <apex:relatedList list="USPS_Shipments__r" rendered="{!packageEnabled.zkUSPS}"/>
    <apex:relatedList list="FedEx_Shipments__r" rendered="{!packageEnabled.zkFedEx}"/>
<!-- RCB: 24082
    <apex:relatedList list="Shipments__r" rendered="{!ZenkraftMC}"/> -->
<!-- RCB: 24450 -->    
    <apex:relatedList list="RSShipments__r" rendered="{!packageEnabled.zkmulti}" />    
    
    <c:footerInclude cntr="{!controller}" />

    
    <script>
        var ProvideSFContact = "{!$Label.PleaseProvideSFContact}";    
        function isocountryChanged(type, name)
        {
            var isocountry = sfffGetFieldValue('soship_isocountry__c');
            console.log('isocountry '+isocountry);
            sfffSetFieldValue('soship_country__c', isocountry);
            
        }
    </script>
    <apex:dynamicComponent componentValue="{!DynamicRelatedLists}" rendered="{!isView}"/>
</apex:page>